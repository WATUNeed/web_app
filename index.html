<!DOCTYPE html>
<html>
<head>
    <title>Telegram WebApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>System Status</h1>
    <div id="status"></div>
    <h2>Session Presence</h2>
    <div id="session-status"></div>
    <h2>Basic Information</h2>
    <div id="basic-info"></div>

    <script>
        var ws = new WebSocket("wss://webapp.containers.cloud.ru/ws");
        let tg = window.Telegram.WebApp;
        let initDataURLSP = new URLSearchParams(tg.initData);
        var requestData = { init_data: initDataURLSP };
        var urlParams = new URLSearchParams(requestData);
        fetch('https://webapp.containers.cloud.ru/check/?' + urlParams)
            .then(response => {
                console.log(response);
                // Display websocket connection status
                document.getElementById('status').innerText = "WebSocket Connection Status: " + (ws.readyState === WebSocket.OPEN ? "Connected" : "Disconnected");
                // Check if "session" key exists in the cookie
                var sessionStatus = document.getElementById('session-status');
                sessionStatus.innerText = "Session Presence: " + (document.cookie.includes("session=") ? "Present" : "Not Present");
                // Display basic system information
                var basicInfo = document.getElementById('basic-info');
                basicInfo.innerText = "Basic Information:\n";
                for (var key in tg) {
                    if (tg.hasOwnProperty(key)) {
                        basicInfo.innerText += key + ": " + tg[key] + "\n";
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });

        // Update websocket connection status dynamically
        ws.onopen = function () {
            document.getElementById('status').innerText = "WebSocket Connection Status: Connected";
        };

        ws.onclose = function () {
            document.getElementById('status').innerText = "WebSocket Connection Status: Disconnected";
        };
    </script>
</body>
</html>
